# Fortune Compass MVP — SSOT Issue

> **Single Source of Truth**: このドキュメントはプロジェクト全体の進捗・タスク・判断履歴を一元管理する。
> 全メンバーはこのIssueを起点に作業状況を確認・更新すること。

---

## 1. プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロダクト名 | Fortune Compass |
| バージョン | v1.2（Phase 8 完了） |
| 目的 | 4占術（星座・数秘術・血液型・タロット）+ 総合ダッシュボードを提供する総合占いWebアプリ |
| 想定作業時間 | 2〜3時間 |
| 実行環境 | AWS ECS Fargate（CloudFront + ALB 経由） |
| 技術スタック | Next.js 16.x + Express 5.x + TypeScript + Tailwind CSS v4 |
| インフラ | AWS (CloudFront / ALB / ECS Fargate / ECR / VPC) |
| IaC | Terraform |
| CI/CD | GitHub Actions |

---

## 2. 関連ドキュメント

| # | ドキュメント | パス | 概要 |
|---|------------|------|------|
| 1 | 仕様書 | [`docs/spec-v1.md`](./spec-v1.md) | 機能要件・API設計・占いロジック・ディレクトリ構成 |
| 2 | デザインシステム | [`docs/design-system.md`](./design-system.md) | カラー・タイポグラフィ・コンポーネント仕様・Tailwind設定 |
| 3 | UI設計方針 | [`docs/ui-design.md`](./ui-design.md) | 画面別ワイヤーフレーム・遷移フロー・状態設計 |
| 4 | テスト設計書 | [`docs/test-design.md`](./test-design.md) | 単体テスト・APIテスト・手動テストケース |
| 5 | UXレビュー | [`docs/ux-review.md`](./ux-review.md) | UX観点のレビュー・改善提案 |
| 6 | インフラ設計書 | [`docs/infra-design.md`](./infra-design.md) | AWS インフラ設計・アーキテクチャ・コスト |
| 7 | AWS サービス一覧 | [`docs/aws-services.md`](./aws-services.md) | 使用 AWS サービスの解説 |

---

## 3. マイルストーン

### M1: プロジェクト初期セットアップ
| タスク | 状態 | 備考 |
|--------|------|------|
| モノレポ構成（ルート package.json + concurrently） | ✅ 完了 | |
| Next.js フロントエンド初期化 | ✅ 完了 | App Router, TypeScript |
| Express バックエンド初期化 | ✅ 完了 | TypeScript, ts-node-dev |
| Tailwind CSS セットアップ | ✅ 完了 | v4（@theme in CSS） |
| デザインシステムの Tailwind 設定反映 | ✅ 完了 | カスタムカラー・フォント・アニメーション |
| `npm run dev` で同時起動確認 | ✅ 完了 | frontend:3000 / backend:8080 |

### M2: バックエンド — 占いロジック + API
| タスク | 状態 | 備考 |
|--------|------|------|
| 星座判定ロジック（zodiac.ts） | ✅ 完了 | 12星座境界値、エレメント、日替わりスコア |
| 数秘術ロジック（numerology.ts） | ✅ 完了 | 運命数算出、マスターナンバー、ピタゴリアン変換 |
| 血液型占いロジック（blood-type.ts） | ✅ 完了 | 固定データ + 日替わりスコア |
| タロット占いロジック（tarot.ts） | ✅ 完了 | 大アルカナ22枚データ、3枚抽出、正逆判定 |
| 占いマスターデータ作成（data/） | ✅ 完了 | zodiac-data, tarot-cards, blood-type-data |
| Express ルーティング（routes/fortune.ts） | ✅ 完了 | 4エンドポイント + バリデーション |
| CORS設定 | ✅ 完了 | 環境変数 CORS_ORIGIN 対応 |

### M3: バックエンド — テスト
| タスク | 状態 | 備考 |
|--------|------|------|
| Jest + ts-jest + supertest セットアップ | ✅ 完了 | |
| 星座占い単体テスト | ✅ 完了 | TC-Z001〜Z004 |
| 数秘術単体テスト | ✅ 完了 | TC-N001〜N004 |
| 血液型占い単体テスト | ✅ 完了 | TC-B001〜B002 |
| タロット占い単体テスト | ✅ 完了 | TC-T001〜T004 |
| APIエンドポイントテスト | ✅ 完了 | TC-API001〜API004 |

### M4: フロントエンド — 画面実装
| タスク | 状態 | 備考 |
|--------|------|------|
| 共通レイアウト（layout.tsx） | ✅ 完了 | ヘッダー、背景、フォント |
| トップページ（/） | ✅ 完了 | ヒーロー、CTA、占術アイコン |
| プロフィール入力（/profile） | ✅ 完了 | フォーム、バリデーション、localStorage保存 |
| 占術選択（/fortune） | ✅ 完了 | ユーザーサマリ、4占術カード |
| 星座占い結果（/fortune/zodiac） | ✅ 完了 | API呼び出し、結果表示 |
| 数秘術結果（/fortune/numerology） | ✅ 完了 | |
| 血液型占い結果（/fortune/blood-type） | ✅ 完了 | |
| タロット結果（/fortune/tarot） | ✅ 完了 | 3枚カード横並び + 詳細 |
| localStorage ユーティリティ（storage.ts） | ✅ 完了 | |
| APIクライアント（api-client.ts） | ✅ 完了 | |
| ローディング / エラー状態 | ✅ 完了 | |

### M5: 結合 + 動作確認
| タスク | 状態 | 備考 |
|--------|------|------|
| フロント ↔ バックエンド結合テスト | ✅ 完了 | |
| 全画面遷移フローの手動確認 | ✅ 完了 | TC-FE001 |
| プロフィール入力の手動確認 | ✅ 完了 | TC-FE002 |
| 各占い結果表示の手動確認 | ✅ 完了 | TC-FE003 |
| レスポンシブ確認 | ✅ 完了 | TC-FE004（Tailwind レスポンシブ対応済み） |
| 最終微調整 | ✅ 完了 | ESLint クリーン |

### M6: AWS デプロイ
| タスク | 状態 | 備考 |
|--------|------|------|
| Dockerfile 作成（frontend / backend） | ✅ 完了 | Multi-stage build |
| ヘルスチェックエンドポイント追加 | ✅ 完了 | /health, /api/health |
| Terraform モジュール作成（5モジュール） | ✅ 完了 | networking, ecr, alb, ecs, cloudfront |
| ECR リポジトリ作成 + イメージ push | ✅ 完了 | frontend / backend |
| ECS Fargate デプロイ | ✅ 完了 | 2サービス稼働中 |
| CloudFront 配置 (HTTPS) | ✅ 完了 | d71oywvumn06c.cloudfront.net |
| GitHub Actions CI/CD 設定 | ✅ 完了 | deploy.yml |

---

## 4. 受け入れ基準（Acceptance Criteria）

### 機能要件
- [ ] ユーザーが名前・生年月日・血液型を入力し、localStorageに保存できる
- [ ] 保存済みプロフィールがフォームに復元される
- [ ] 星座占い: 生年月日から正しい星座を判定し、スコア・ラッキー情報・アドバイスを表示する
- [ ] 数秘術: 運命数を正しく算出し（マスターナンバー対応）、性格特徴・年運・相性を表示する
- [ ] 血液型占い: 4血液型に対応した性格・スコア・相性ランキング・アドバイスを表示する
- [ ] タロット占い: 大アルカナ22枚から重複なし3枚を抽出し、正逆位置付きで過去・現在・未来を表示する
- [ ] 血液型未登録時、血液型占いが適切に制御される（グレーアウト or 誘導）

### 非機能要件
- [ ] `npm run dev` 一発でフロント（:3000）+ バック（:8080）が起動する
- [ ] バックエンドの単体テスト・APIテストが全てパスする
- [ ] モバイル（375px）〜デスクトップ（1024px）でレイアウトが崩れない
- [ ] API レスポンスタイムが 200ms 以内（ローカル環境）

---

## 5. 技術的な判断記録

| # | 日付 | 判断内容 | 理由 |
|---|------|---------|------|
| 1 | — | プロフィールAPIを作らずlocalStorageのみ | MVPスコープ縮小。サーバーにユーザーデータを持たない |
| 2 | — | 小アルカナ（56枚）は対象外 | MVP範囲。大アルカナ22枚で十分な体験を提供 |
| 3 | — | フロントエンドテストは手動確認 | 2〜3時間の制約内ではバックエンドロジックのテストを優先 |
| 4 | — | タロットカードは画像なし（テキスト表現） | 素材準備の工数を削減 |
| 5 | — | フリガナ → ローマ字変換はフロント側で実施 | 数秘術APIにはローマ字を送る設計 |
| 6 | — | 日替わり運勢はシード付き擬似ランダム | 同日・同条件で同じ結果を保証しつつ日替わりを実現 |

---

## 6. 実装順序（推奨）

```
M1 セットアップ（20分）
  ↓
M2 バックエンドロジック + API（50分）
  ↓
M3 バックエンドテスト（20分）
  ↓
M4 フロントエンド画面（50分）
  ↓
M5 結合 + 動作確認（20分）
```

合計: 約2時間40分

### M7: Phase 7 — 機能拡充（8機能追加）
| タスク | 状態 | 備考 |
|--------|------|------|
| 色コントラスト修正（WCAG AA準拠） | ✅ 完了 | text-secondary #a89ec4→#b8b0d0, text-muted #6b6183→#8a80a0 |
| 結果→他占術遷移（OtherFortunes） | ✅ 完了 | 全4結果ページに他3占術ショートカット追加 |
| アドバイス文拡充（2〜3文化） | ✅ 完了 | 星座・数秘術・血液型・タロット全占術のアドバイス拡充 |
| カタカナ→ローマ字変換精度向上 | ✅ 完了 | 外来語音 + 小書き文字対応追加 |
| SEO改善 | ✅ 完了 | sitemap.xml, robots.txt, JSON-LD構造化データ |
| パフォーマンス最適化 | ✅ 完了 | Noto Sans JP weight指定(400/500/700), DNS prefetch |
| SNSシェア機能 | ✅ 完了 | X(Twitter)/LINE/Facebook/クリップボード |
| 占い履歴 | ✅ 完了 | localStorage保存(最大50件) + /history ページ |

### M8: Phase 8 — 総合運勢ダッシュボード
| タスク | 状態 | 備考 |
|--------|------|------|
| ダッシュボードAPI（POST /api/fortune/dashboard） | ✅ 完了 | 4占術一括実行 + レーダースコア算出 |
| SVGレーダーチャート（RadarChart.tsx） | ✅ 完了 | 4軸（総合運/恋愛運/仕事運/金運）、外部ライブラリ不使用 |
| ダッシュボードページ（/fortune/dashboard） | ✅ 完了 | レーダーチャート + 4占術サマリー + 総合アドバイス + SNSシェア |
| 占術選択ページにダッシュボードバナー追加 | ✅ 完了 | /fortune ページ上部にグラデーションバナー |

---

## 7. スコープ外（将来対応）

以下は今後のフェーズで対応する。

- 四柱推命 / 九星気学 / 手相AI
- Claude API連携によるAI総合診断
- 今日の運勢バッチ処理
- お気に入り機能
- ユーザー認証
- カスタムドメイン（Route 53 + ACM）

---

## 8. 更新履歴

| 日付 | 更新内容 |
|------|---------|
| 2026-02-16 | 初版作成。MVP全タスク定義 |
| 2026-02-16 | M1〜M5 全タスク完了。テスト75件パス、ESLint クリーン |
| 2026-02-16 | M6 追加。AWS デプロイ完了（ECS Fargate + CloudFront） |
| 2026-02-16 | 技術スタック・関連ドキュメント・スコープ外を最新化 |
| 2026-02-17 | M7 追加。Phase 7 機能拡充（8機能）全タスク完了、デプロイ成功 |
| 2026-02-17 | M8 追加。Phase 8 総合運勢ダッシュボード全タスク完了、デプロイ成功 |
| 2026-02-17 | スコープ外を更新。実装済み項目（履歴・SNSシェア・E2E・多言語・PWA）を除外 |
