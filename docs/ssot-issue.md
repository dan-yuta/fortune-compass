# Fortune Compass MVP — SSOT Issue

> **Single Source of Truth**: このドキュメントはプロジェクト全体の進捗・タスク・判断履歴を一元管理する。
> 全メンバーはこのIssueを起点に作業状況を確認・更新すること。

---

## 1. プロジェクト概要

| 項目 | 内容 |
|------|------|
| プロダクト名 | Fortune Compass |
| バージョン | v1.0（MVP） |
| 目的 | 4占術（星座・数秘術・血液型・タロット）を提供する総合占いWebアプリ |
| 想定作業時間 | 2〜3時間 |
| 実行環境 | ローカル環境（localhost） |
| 技術スタック | Next.js 15.x + Express + TypeScript + Tailwind CSS + shadcn/ui |

---

## 2. 関連ドキュメント

| # | ドキュメント | パス | 概要 |
|---|------------|------|------|
| 1 | 仕様書 | [`docs/spec-v1.md`](./spec-v1.md) | 機能要件・API設計・占いロジック・ディレクトリ構成 |
| 2 | デザインシステム | [`docs/design-system.md`](./design-system.md) | カラー・タイポグラフィ・コンポーネント仕様・Tailwind設定 |
| 3 | UI設計方針 | [`docs/ui-design.md`](./ui-design.md) | 画面別ワイヤーフレーム・遷移フロー・状態設計 |
| 4 | テスト設計書 | [`docs/test-design.md`](./test-design.md) | 単体テスト・APIテスト・手動テストケース |
| 5 | UXレビュー | [`docs/ux-review.md`](./ux-review.md) | UX観点のレビュー・改善提案 |

---

## 3. マイルストーン

### M1: プロジェクト初期セットアップ
| タスク | 状態 | 備考 |
|--------|------|------|
| モノレポ構成（ルート package.json + concurrently） | ⬜ 未着手 | |
| Next.js フロントエンド初期化 | ⬜ 未着手 | App Router, TypeScript |
| Express バックエンド初期化 | ⬜ 未着手 | TypeScript, ts-node-dev |
| Tailwind CSS + shadcn/ui セットアップ | ⬜ 未着手 | |
| デザインシステムの Tailwind 設定反映 | ⬜ 未着手 | カスタムカラー・フォント・アニメーション |
| `npm run dev` で同時起動確認 | ⬜ 未着手 | frontend:3000 / backend:8080 |

### M2: バックエンド — 占いロジック + API
| タスク | 状態 | 備考 |
|--------|------|------|
| 星座判定ロジック（zodiac.ts） | ⬜ 未着手 | 12星座境界値、エレメント、日替わりスコア |
| 数秘術ロジック（numerology.ts） | ⬜ 未着手 | 運命数算出、マスターナンバー、ピタゴリアン変換 |
| 血液型占いロジック（blood-type.ts） | ⬜ 未着手 | 固定データ + 日替わりスコア |
| タロット占いロジック（tarot.ts） | ⬜ 未着手 | 大アルカナ22枚データ、3枚抽出、正逆判定 |
| 占いマスターデータ作成（data/） | ⬜ 未着手 | zodiac-data, tarot-cards, blood-type-data |
| Express ルーティング（routes/fortune.ts） | ⬜ 未着手 | 4エンドポイント + バリデーション |
| CORS設定 | ⬜ 未着手 | localhost:3000 を許可 |

### M3: バックエンド — テスト
| タスク | 状態 | 備考 |
|--------|------|------|
| Jest + ts-jest + supertest セットアップ | ⬜ 未着手 | |
| 星座占い単体テスト | ⬜ 未着手 | TC-Z001〜Z004 |
| 数秘術単体テスト | ⬜ 未着手 | TC-N001〜N004 |
| 血液型占い単体テスト | ⬜ 未着手 | TC-B001〜B002 |
| タロット占い単体テスト | ⬜ 未着手 | TC-T001〜T004 |
| APIエンドポイントテスト | ⬜ 未着手 | TC-API001〜API004 |

### M4: フロントエンド — 画面実装
| タスク | 状態 | 備考 |
|--------|------|------|
| 共通レイアウト（layout.tsx） | ⬜ 未着手 | ヘッダー、背景、フォント |
| トップページ（/） | ⬜ 未着手 | ヒーロー、CTA、占術アイコン |
| プロフィール入力（/profile） | ⬜ 未着手 | フォーム、バリデーション、localStorage保存 |
| 占術選択（/fortune） | ⬜ 未着手 | ユーザーサマリ、4占術カード |
| 星座占い結果（/fortune/zodiac） | ⬜ 未着手 | API呼び出し、結果表示 |
| 数秘術結果（/fortune/numerology） | ⬜ 未着手 | |
| 血液型占い結果（/fortune/blood-type） | ⬜ 未着手 | |
| タロット結果（/fortune/tarot） | ⬜ 未着手 | 3枚カード横並び + 詳細 |
| localStorage ユーティリティ（storage.ts） | ⬜ 未着手 | |
| APIクライアント（api-client.ts） | ⬜ 未着手 | |
| ローディング / エラー状態 | ⬜ 未着手 | |

### M5: 結合 + 動作確認
| タスク | 状態 | 備考 |
|--------|------|------|
| フロント ↔ バックエンド結合テスト | ⬜ 未着手 | |
| 全画面遷移フローの手動確認 | ⬜ 未着手 | TC-FE001 |
| プロフィール入力の手動確認 | ⬜ 未着手 | TC-FE002 |
| 各占い結果表示の手動確認 | ⬜ 未着手 | TC-FE003 |
| レスポンシブ確認 | ⬜ 未着手 | TC-FE004 |
| 最終微調整 | ⬜ 未着手 | |

---

## 4. 受け入れ基準（Acceptance Criteria）

### 機能要件
- [ ] ユーザーが名前・生年月日・血液型を入力し、localStorageに保存できる
- [ ] 保存済みプロフィールがフォームに復元される
- [ ] 星座占い: 生年月日から正しい星座を判定し、スコア・ラッキー情報・アドバイスを表示する
- [ ] 数秘術: 運命数を正しく算出し（マスターナンバー対応）、性格特徴・年運・相性を表示する
- [ ] 血液型占い: 4血液型に対応した性格・スコア・相性ランキング・アドバイスを表示する
- [ ] タロット占い: 大アルカナ22枚から重複なし3枚を抽出し、正逆位置付きで過去・現在・未来を表示する
- [ ] 血液型未登録時、血液型占いが適切に制御される（グレーアウト or 誘導）

### 非機能要件
- [ ] `npm run dev` 一発でフロント（:3000）+ バック（:8080）が起動する
- [ ] バックエンドの単体テスト・APIテストが全てパスする
- [ ] モバイル（375px）〜デスクトップ（1024px）でレイアウトが崩れない
- [ ] API レスポンスタイムが 200ms 以内（ローカル環境）

---

## 5. 技術的な判断記録

| # | 日付 | 判断内容 | 理由 |
|---|------|---------|------|
| 1 | — | プロフィールAPIを作らずlocalStorageのみ | MVPスコープ縮小。サーバーにユーザーデータを持たない |
| 2 | — | 小アルカナ（56枚）は対象外 | MVP範囲。大アルカナ22枚で十分な体験を提供 |
| 3 | — | フロントエンドテストは手動確認 | 2〜3時間の制約内ではバックエンドロジックのテストを優先 |
| 4 | — | タロットカードは画像なし（テキスト表現） | 素材準備の工数を削減 |
| 5 | — | フリガナ → ローマ字変換はフロント側で実施 | 数秘術APIにはローマ字を送る設計 |
| 6 | — | 日替わり運勢はシード付き擬似ランダム | 同日・同条件で同じ結果を保証しつつ日替わりを実現 |

---

## 6. 実装順序（推奨）

```
M1 セットアップ（20分）
  ↓
M2 バックエンドロジック + API（50分）
  ↓
M3 バックエンドテスト（20分）
  ↓
M4 フロントエンド画面（50分）
  ↓
M5 結合 + 動作確認（20分）
```

合計: 約2時間40分

---

## 7. スコープ外（将来対応）

以下はMVP後のフェーズで対応する。このIssue内では扱わない。

- 四柱推命 / 九星気学 / 手相AI
- Claude API連携によるAI総合診断
- 今日の運勢バッチ処理
- 履歴・お気に入り・SNSシェア
- ユーザー認証
- DynamoDB / Docker / AWS デプロイ
- E2Eテスト（Playwright等）
- 多言語対応
- PWA対応

---

## 8. 更新履歴

| 日付 | 更新内容 |
|------|---------|
| 2026-02-16 | 初版作成。MVP全タスク定義 |
